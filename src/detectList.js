const objectList=[];
const globalWindowFunction = [
    "alert",
    "addEventListener",
    "confirm",
    "prompt",
    "eval",
    "setTimeout",
    "setInterval",
    "clearTimeout",
    "clearInterval",
    "fetch",
    "close",
    "atob",
    "btoa",
    "postMessage",
    "focus",
    "open",
    "print",
    "stop",
    "getSelection",
    "parseFloat",
    "parseInt",
    "isFinite",
    "isNaN",
    "decodeURI",
    "decodeURIComponent",
    "encodeURI",
    "encodeURIComponent",
    "requestAnimationFrame",
    "cancelAnimationFrame",
    "requestIdleCallback",
    "cancelIdleCallback",
    "createImageBitmap",
    "getComputedStyle",
    "matchMedia",
    "moveBy",
    "moveTo",
    "queueMicrotask",
    "reportError",
    "resizeBy",
    "resizeTo",
    "scroll",
    "scrollBy",
    "scrollTo",
    "structuredClone",
    
];
/**
 * @type {{
 *  name:string|{},
 * protoProp:string,
 * enableHookDetect:boolean,
 * topName:string,
 * keys?:string[],
 * nonProtect:boolean,
 * detectExclude?:string[]
 * }[]}
 */
const detectGlobalObjectList=[
    {name:"crypto",protoProp:"__proto__",enableHookDetect:false,topName:"crypto"},
    {name:document.__proto__.__proto__,protoProp:"__proto__",enableHookDetect:false,topName:"Document",keys:Object.keys(document.__proto__.__proto__)},
    {name:"customElements",protoProp:"__proto__",topName:"customElements",enableHookDetect:false},
    {name:"documentPictureInPicture",protoProp:"__proto__",keys:["requestWindow"],topName:"documentPictureInPicture",enableHookDetect:false},
    {name:"history",protoProp:"__proto__",topName:"history",enableHookDetect:false},
    {name:"indexedDB",protoProp:"__proto__",topName:"indexedDB",enableHookDetect:false},
    {name:"localStorage",protoProp:"__proto__",topName:"localStorage",enableHookDetect:false},
    {name:"location",topName:"location",enableHookDetect:false},
    {name:"navigation",protoProp:"__proto__",topName:"navigation",enableHookDetect:false},
    {name:"performance",protoProp:"__proto__",topName:"performance",enableHookDetect:false},
    {name:"speechSynthesis",protoProp:"__proto__",topName:"speechSynthesis",enableHookDetect:false},
    {name:Object,topName:"Object",nonProtect:true},
    {name:"Reflect",topName:"Reflect",nonProtect:true,keys:["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","has","ownKeys","set","setPrototypeOf"],enableHookDetect:false},
    {name:"URL",protoProp:"__proto__",topName:"URL"},
    {name:console,keys:["log","info","debug","warn","error"],topName:"console",enableHookDetect:false},
    {name:"AbortController",protoProp:"prototype",keys:["abort"],topName:"AbortController"},
    {name:"AbortSignal",topName:"AbortSignal",keys:["abort","any","timeout"]},
    {name:"AnalyserNode",protoProp:"prototype",topName:"AnalyserNode"},
    //静态方法
    {name:"Array",topName:"Array",enableHookDetect:false},
    //原型链上的实例方法
    {name:Array.prototype,top:Array,topName:"Array"},
    {name:"ArrayBuffer",protoProp:"prototype",topName:"ArrayBuffer"},
    {name:"Atomics",topName:"Atomics",enableHookDetect:false},
    {name:"AudioBuffer",protoProp:"prototype",topName:"AudioBuffer"},
    {name:"AudioContext",protoProp:"prototype",topName:"AudioContext"},
    {name:"AudioDecoder",protoProp:"prototype",topName:"AudioDecoder"},
    {name:"AudioEncoder",protoProp:"prototype",topName:"AudioEncoder"},
    {name:"AudioNode",protoProp:"prototype",topName:"AudioNode"},
    {name:"BaseAudioContext",protoProp:"prototype",topName:"BaseAudioContext"},
    {name:"BigInt",topName:"BigInt"},
    {name:"Blob",protoProp:"prototype",topName:"Blob"},
    {name:"BroadcastChannel",protoProp:"prototype",topName:"BroadcastChannel"},
    {name:"Cache",protoProp:"prototype",topName:"Cache"},
    {name:"CacheStorage",protoProp:"prototype",topName:"CacheStorage"},
    {name:"CanvasRenderingContext2D",protoProp:"prototype",topName:"CanvasRenderingContext2D",detectExclude:["getImageData"] },
    {name:"Clipboard",protoProp:"prototype",topName:"Clipboard"},
    {name:"CookieStore",protoProp:"prototype",topName:"CookieStore"},
    {name:"CryptoKey",protoProp:"prototype",topName:"CryptoKey"},
    {name:"CustomEvent",protoProp:"prototype",topName:"CustomEvent"},
    {name:"CSS",topName:"CSS",enableHookDetect:false},
    {name:"CustomElementRegistry",protoProp:"prototype",topName:"CustomElementRegistry"},
    {name:"DataView",protoProp:"prototype",topName:"DataView"},
    {name:"Date",protoProp:"prototype",topName:"Date",detectExclude:["toGMTString","valueOf"]},
    {name:"DocumentFragment",protoProp:"prototype",topName:"DocumentFragment"},
    {name:"Error",protoProp:"prototype",topName:"Error"},
    {name:"Int8Array",protoProp:"prototype",topName:"Int8Array"},
    {name:"Uint8Array",protoProp:"prototype",topName:"Uint8Array"},
    {name:"Int16Array",protoProp:"prototype",topName:"Int16Array"},
    {name:"Uint16Array",protoProp:"prototype",topName:"Uint16Array"},
    {name:"Int32Array",protoProp:"prototype",topName:"Int32Array"},
    {name:"Uint32Array",protoProp:"prototype",topName:"Uint32Array"},
    {name:"BigInt64Array",protoProp:"prototype",topName:"BigInt64Array"},
    {name:"BigUint64Array",protoProp:"prototype",topName:"BigUint64Array"},
    {name:"Float32Array",protoProp:"prototype",topName:"Float32Array"},
    {name:"Float64Array",protoProp:"prototype",topName:"Float64Array"},
    {name:"Headers",protoProp:"prototype",topName:"Headers"},
    {name:"History",protoProp:"prototype",topName:"History"},
    {name:"HTMLAnchorElement",protoProp:"prototype",topName:"HTMLAnchorElement"},
    {name:"HTMLAreaElement",protoProp:"prototype",topName:"HTMLAreaElement"},
    {name:"HTMLAudioElement",protoProp:"prototype",topName:"HTMLAudioElement"},
    {name:"HTMLBodyElement",protoProp:"prototype",topName:"HTMLBodyElement"},
    {name:"HTMLButtonElement",protoProp:"prototype",topName:"HTMLButtonElement"},
    {name:"HTMLCanvasElement",protoProp:"prototype",topName:"HTMLCanvasElement"},
    {name:"HTMLCollection",protoProp:"prototype",topName:"HTMLCollection"},
    {name:"HTMLDialogElement",protoProp:"prototype",topName:"HTMLDialogElement"},
    {name:"HTMLBodyElement",protoProp:"prototype",topName:"HTMLBodyElement"},
    {name:"HTMLFormElement",protoProp:"prototype",topName:"HTMLFormElement"},
    {name:"HTMLFrameElement",protoProp:"prototype",topName:"HTMLFrameElement"},
    {name:"HTMLHeadElement",protoProp:"prototype",topName:"HTMLHeadElement"},
    {name:"HTMLHtmlElement",protoProp:"prototype",topName:"HTMLHtmlElement"},
    {name:"HTMLIFrameElement",protoProp:"prototype",topName:"HTMLIFrameElement"},
    {name:"HTMLImageElement",protoProp:"prototype",topName:"HTMLImageElement"},
    {name:"HTMLInputElement",protoProp:"prototype",topName:"HTMLInputElement"},
    {name:"HTMLLabelElement",protoProp:"prototype",topName:"HTMLLabelElement"},
    {name:"HTMLLinkElement",protoProp:"prototype",topName:"HTMLLinkElement"},
    {name:"HTMLMenuElement",protoProp:"prototype",topName:"HTMLMenuElement"},
    {name:"HTMLModElement",protoProp:"prototype",topName:"HTMLModElement"},
    {name:"HTMLObjectElement",protoProp:"prototype",topName:"HTMLObjectElement"},
    {name:"HTMLOptionElement",protoProp:"prototype",topName:"HTMLOptionElement"},
    {name:"HTMLOptionsCollection",protoProp:"prototype",topName:"HTMLOptionsCollection",enableHookDetect:false},
    {name:"HTMLOutputElement",protoProp:"prototype",topName:"HTMLOutputElement"},
    {name:"HTMLPictureElement",protoProp:"prototype",topName:"HTMLPictureElement"},
    {name:"HTMLProgressElement",protoProp:"prototype",topName:"HTMLProgressElement"},
    {name:"HTMLScriptElement",protoProp:"prototype",topName:"HTMLScriptElement"},
    {name:"HTMLSelectElement",protoProp:"prototype",topName:"HTMLSelectElement"},
    {name:"HTMLSlotElement",protoProp:"prototype",topName:"HTMLSlotElement"},
    {name:"HTMLSourceElement",protoProp:"prototype",topName:"HTMLSourceElement"},
    {name:"HTMLSpanElement",protoProp:"prototype",topName:"HTMLSpanElement"},
    {name:"HTMLStyleElement",protoProp:"prototype",topName:"HTMLStyleElement"},
    {name:"HTMLTableCellElement",protoProp:"prototype",topName:"HTMLTableCellElement"},
    {name:"HTMLTableColElement",protoProp:"prototype",topName:"HTMLTableColElement"},
    {name:"HTMLTableElement",protoProp:"prototype",topName:"HTMLTableElement"},
    {name:"HTMLTableRowElement",protoProp:"prototype",topName:"HTMLTableRowElement"},
    {name:"HTMLTableSectionElement",protoProp:"prototype",topName:"HTMLTableSectionElement"},
    {name:"HTMLTemplateElement",protoProp:"prototype",topName:"HTMLTemplateElement"}, 
    {name:"HTMLTextAreaElement",protoProp:"prototype",topName:"HTMLTextAreaElement"},
    {name:"HTMLVideoElement",protoProp:"prototype",topName:"HTMLVideoElement"},
    //这几个HTML元素要放后面处理
    {name:"HTMLMediaElement",protoProp:"prototype",topName:"HTMLMediaElement"},
    {name:"HTMLElement",protoProp:"prototype",topName:"HTMLElement"},
    {name:"Element",protoProp:"prototype",topName:"Element"},
    {name:"IDBCursor",protoProp:"prototype",topName:"IDBCursor"},
    {name:"IDBDatabase",protoProp:"prototype",topName:"IDBDatabase"},
    {name:"IDBFactory",protoProp:"prototype",topName:"IDBFactory"},
    {name:"IDBIndex",protoProp:"prototype",topName:"IDBIndex"},
    {name:"IDBObjectStore",protoProp:"prototype",topName:"IDBObjectStore"},
    {name:"ImageBitmap",protoProp:"prototype",topName:"ImageBitmap"},
    {name:"ImageData",protoProp:"prototype",topName:"ImageData"},
    {name:"ImageDecoder",protoProp:"prototype",topName:"ImageDecoder"},
    {name:"JSON",topName:"JSON",enableHookDetect:false},
    {name:"Map",protoProp:"prototype",topName:"Map"},
    {name:"Math",topName:"Math",enableHookDetect:false},
    {name:"MediaDevices",protoProp:"prototype",topName:"MediaDevices"},
    {name:"MediaSession",protoProp:"prototype",topName:"MediaSession"},
    {name:"Navigation",protoProp:"prototype",topName:"Navigation"},
    {name:"Navigator",protoProp:"prototype",topName:"Navigator"},
    {name:"Node",protoProp:"prototype",topName:"Node"},
    {name:"Notification",topName:"Notification",keys:["requestPermission"]},
    {name:"Number",topName:"Number"},
    {name:"OffscreenCanvas",protoProp:"prototype",topName:"OffscreenCanvas"},
    {name:"OffscreenCanvasRenderingContext2D",protoProp:"prototype",topName:"OffscreenCanvasRenderingContext2D"},
    {name:"Path2D",protoProp:"prototype",topName:"Path2D"},
    {name:"Permissions",protoProp:"prototype",topName:"Permissions",keys:["query"]},
    {name:"PerformanceMark",protoProp:"prototype",topName:"PerformanceMark"},
    {name:"PerformanceMeasure",protoProp:"prototype",topName:"PerformanceMeasure"},
    {name:"PerformanceObserver",protoProp:"prototype",topName:"PerformanceObserver"},
    {name:"PerformanceResourceTiming",protoProp:"prototype",topName:"PerformanceResourceTiming"},
    {name:"Promise",topName:"Promise"},
    {name:"Promise",protoProp:"prototype",topName:"Promise"},
    {name:"PublicKeyCredential",protoProp:"prototype",topName:"PublicKeyCredential"},
    {name:"RTCDataChannel",protoProp:"prototype",topName:"RTCDataChannel"},
    {name:"RTCEncodedAudioFrame",protoProp:"prototype",topName:"RTCEncodedAudioFrame"},
    {name:"RTCEncodedVideoFrame",protoProp:"prototype",topName:"RTCEncodedVideoFrame"},
    {name:"RTCIceCandidate",protoProp:"prototype",topName:"RTCIceCandidate"},
    {name:"RTCPeerConnection",protoProp:"prototype",topName:"RTCPeerConnection"},
    {name:"RTCRtpReceiver",protoProp:"prototype",topName:"RTCRtpReceiver"},
    {name:"RTCRtpSender",protoProp:"prototype",topName:"RTCRtpSender"},
    {name:"ReadableStream",protoProp:"prototype",topName:"ReadableStream"},
    {name:"RegExp",protoProp:"prototype",topName:"RegExp",keys:["test","exec","compile"]},
    {name:"Selection",protoProp:"prototype",topName:"Selection"},
    {name:"ServiceWorker",protoProp:"prototype",topName:"ServiceWorker",keys:["postMessage"]},
    {name:"Set",protoProp:"prototype",topName:"Set",detectExclude:["keys","valueOf"]},
    {name:"ShadowRoot",protoProp:"prototype",topName:"ShadowRoot"},
    {name:"String",topName:"String",keys:["fromCharCode","fromCodePoint","raw"]},
    {name:"String",protoProp:"prototype",topName:"String",enableHookDetect:false,detectExclude:["trimLeft","trimRight","valueOf"]},
    {name:"TextEncoder",protoProp:"prototype",topName:"TextEncoder"},
    {name:"TextDecoder",protoProp:"prototype",topName:"TextDecoder"},
    {name:"TreeWalker",protoProp:"prototype",topName:"TreeWalker"},
    {name:"Touch",protoProp:"prototype",topName:"Touch"},
    {name:"VideoDecoder",protoProp:"prototype",topName:"VideoDecoder"},
    {name:"VideoEncoder",protoProp:"prototype",topName:"VideoEncoder"},
    {name:"WakeLock",protoProp:"prototype",topName:"WakeLock",keys:["request"]},
    {name:"WakeLockSentinel",protoProp:"prototype",topName:"WakeLockSentinel",keys:["release"]},
    {name:"WeakMap",protoProp:"prototype",topName:"WeakMap"},
    {name:"WeakSet",protoProp:"prototype",topName:"WeakSet"},
    {name:"WeakRef",protoProp:"prototype",topName:"WeakRef"},
    {name:"WebAssembly",topName:"WebAssembly",enableHookDetect:false},
    {name:"WebGL2RenderingContext",protoProp:"prototype",topName:"WebGL2RenderingContext"},
    {name:"Worker",protoProp:"prototype",topName:"Worker"},
    {name:"Worklet",protoProp:"prototype",topName:"Worklet",keys:["addModule"]},
    {name:"XMLHttpRequest",protoProp:"prototype",topName:"XMLHttpRequest"},
]
function getGlobalObjects(){
    // return globalObject
    if (objectList.length!==0) {
        return objectList;
    }
    for (const item of detectGlobalObjectList) {
        if (!(window[item.name])) {
            continue
        }
        objectList.push({
            parent:item.name instanceof Object?item.name:item.protoProp?window[item.name][item.protoProp]:window[item.name],
            top:window[item.name],
            topName:item.topName??item.name,
            keys:item.keys??null,
            enableHookDetect:item.enableHookDetect,
            nonProtect:item.nonProtect,
            detectExclude:item.detectExclude
        });
    }
    // console.log(objectList);
    return objectList;
}
export {
    globalWindowFunction,
    getGlobalObjects
}